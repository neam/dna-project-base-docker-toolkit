# Phundament 4 - Local Development Stack
# ======================================

# Application services
# --------------------

# container to run one-off commands - a dockerized shell
appcli:
  # should be replaced with image, eg. <project_name>_appsrc
  image: phundament/php:5.6-cli-dev
  links:
    - 'appnginx:WEB'
    - 'mariadb:DB'
  volumes_from:
    - appsrc
  command: 'sh src/run.sh'

# The php-fpm server for interpreting php code
appfpm:
  image: phundament/php:5.6-fpm-dev
  volumes_from:
    - 'appsrc'
  links:
    - 'mariadb:DB'

# The nginx server for serving static files directly
appnginx:
  image: schmunk42/nginx:1.9
  links:
    - 'appfpm:PHPFPM'
  volumes_from:
    - 'appsrc'
  ports:
    - '80'
  environment:
    VIRTUAL_HOST: '~^dev\.myapp\.'

# Build-container with CLI and source-code
appsrc:
  image: phundament/php:5.6-cli-dev
  command: 'tail -f /dev/null'
  # host-volume for local development
  volumes:
    - '/app'

# Data Services
# -------------
mariadb:
  image: tutum/mariadb:10.1
  ports:
    - '3306'
  environment:
    MARIADB_PASS: 'secretadmin'
