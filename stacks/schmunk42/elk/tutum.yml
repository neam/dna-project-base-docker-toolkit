elasticsearchdata:
  tags:
   - staging
   - data
  image: 'alpine'
  command: '/bin/true'
  volumes:
   - '/data/elasticsearch:/usr/share/elasticsearch/data'

elasticsearch:
  tags:
   - staging
   - data
  image: 'elasticsearch:1.5'
  ports:
  - '9200:9200'
  volumes_from:
  - 'elasticsearchdata'

logstash:
  tags:
   - staging
   - data
  image: 'logstash'
  command: 'logstash -e ''input { syslog { port => 12345 type => "docker" } } output { elasticsearch_http { host => "elasticsearch" } }'''
  expose:
  - '12345/tcp'
  - '12345/udp'
  links:
  - elasticsearch

logspout:
  image: 'gliderlabs/logspout'
  entrypoint: '/bin/sh'
  command: '-c ''/bin/logspout syslog://$LOGSTASH_PORT_12345_UDP_ADDR:12345'''
  deployment_strategy: every_node
  volumes:
  - '/var/run/docker.sock:/tmp/docker.sock'
  links:
  - logstash

kibana:
  tags:
   - staging
   - data
  image: marcbachmann/kibana4
  environment:
  - ELASTICSEARCH=http://elasticsearch:9200
  ports:
  - '5601:5601'
  links:
  - elasticsearch